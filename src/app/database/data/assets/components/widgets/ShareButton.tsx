import { useMemo } from "react";
// Assuming toast is available via a global provider, otherwise we need to install/configure.
// If not using react-toastify, we might need another solution, but for now assuming it persists.
import { toast } from "react-toastify";

interface ShareButtonProps {
  title?: string;
  text?: string;
  url?: string;
}

export default function ShareButton({ title, text, url }: ShareButtonProps) {
  const canNativeShare = typeof navigator !== "undefined" && !!navigator.share;

  const onShare = async () => {
    const shareData = {
      title: title || document.title,
      text: text || "Share this for you！",
      url: url || window.location.href,
    };

    try {
      if (canNativeShare) {
        await navigator.share(shareData);
      } else {
        await navigator.clipboard.writeText(shareData.url);
        toast.success("copied link！", {
          position: "top-center",
          autoClose: 2000,
        });
      }
    } catch (err) {
      console.debug("Share canceled or failed:", err);
    }
  };

  return (
    <button
      type="button"
      onClick={onShare}
      className="inline-flex items-center gap-2 px-4 py-2.5 font-medium text-sm1 text-primaryBlue-600 active:scale-[0.98]"
      aria-label="Share"
      title={canNativeShare ? "Share with system" : "copy link to clipboard"}
    >
      <svg
        width={24}
        height={24}
        viewBox="0 0 24 24"
        fill="none"
        xmlns="http://www.w3.org/2000/svg"
        className="flex-grow-0 flex-shrink-0 w-6 h-6 relative"
        preserveAspectRatio="none"
      >
        <path
          fillRule="evenodd"
          clipRule="evenodd"
          d="M17.3133 1.91562C18.0003 1.53401 18.8095 1.43713 19.567 1.64583C20.3246 1.85453 20.9701 2.35214 21.3646 3.03168C21.5649 3.37652 21.6943 3.75781 21.7455 4.15328C21.7966 4.54874 21.7684 4.95043 21.6625 5.33486C21.5566 5.71929 21.3751 6.07876 21.1287 6.39223C20.8823 6.70571 20.5758 6.96691 20.2272 7.16056C19.8786 7.35422 19.4949 7.47643 19.0986 7.52007C18.7022 7.56371 18.3011 7.5279 17.9188 7.41472C17.5364 7.30154 17.1805 7.11327 16.8717 6.86092C16.7627 6.77179 16.6603 6.67529 16.5652 6.57224L8.1538 11.2449C8.21656 11.4863 8.25005 11.7394 8.25005 12.0003C8.25005 12.2608 8.21663 12.5141 8.15388 12.7557L16.5749 17.4337C16.941 17.0483 17.4063 16.7636 17.9261 16.615C18.6913 16.3964 19.5121 16.4907 20.2078 16.8772C20.9035 17.2636 21.4171 17.9107 21.6358 18.6759C21.8544 19.4411 21.7602 20.2618 21.3737 20.9575C21.1823 21.302 20.925 21.6054 20.6164 21.8504C20.3077 22.0954 19.9539 22.2773 19.575 22.3855C19.1961 22.4938 18.7996 22.5264 18.4081 22.4814C18.0166 22.4364 17.6378 22.3148 17.2933 22.1234C16.9489 21.932 16.6454 21.6747 16.4004 21.3661C16.1554 21.0575 15.9736 20.7036 15.8653 20.3247C15.757 19.9458 15.7245 19.5493 15.7694 19.1578C15.7855 19.0183 15.8113 18.8803 15.8465 18.745L7.4251 14.0668C7.14628 14.3602 6.80913 14.5961 6.43231 14.7576C5.82146 15.0195 5.14096 15.0711 4.49762 14.9043C3.85428 14.7376 3.28452 14.3619 2.87779 13.8363C2.47105 13.3107 2.25037 12.6649 2.25037 12.0003C2.25037 11.3357 2.47105 10.6899 2.87779 10.1643C3.28452 9.63868 3.85428 9.26302 4.49762 9.09626C5.14096 8.9295 5.82146 8.98109 6.43231 9.24293C6.80913 9.40445 7.14628 9.64034 7.4251 9.93376L15.856 5.2503C15.7311 4.73912 15.7418 4.19955 15.8937 3.68661C16.1167 2.93313 16.6264 2.29724 17.3133 1.91562ZM6.56143 11.2715C6.40001 10.9811 6.14673 10.7525 5.84134 10.6216C5.53591 10.4907 5.19566 10.4649 4.87399 10.5483C4.55232 10.6317 4.26745 10.8195 4.06408 11.0823C3.86071 11.3451 3.75037 11.668 3.75037 12.0003C3.75037 12.3326 3.86071 12.6555 4.06408 12.9183C4.26745 13.1811 4.55232 13.3689 4.87399 13.4523C5.19566 13.5357 5.53591 13.5099 5.84134 13.379C6.14676 13.248 6.40007 13.0194 6.56149 12.729L6.56191 12.7282C6.68135 12.5139 6.75005 12.2662 6.75005 12.0003C6.75005 11.735 6.68162 11.4879 6.56149 11.2716M19.1687 3.09196C18.7899 2.98761 18.3853 3.03605 18.0418 3.22686C17.6984 3.41766 17.4435 3.73561 17.332 4.11235C17.2205 4.48909 17.2612 4.89454 17.4455 5.24155C17.539 5.41765 17.6666 5.57333 17.821 5.69951C17.9754 5.82568 18.1534 5.91982 18.3445 5.9764C18.5357 6.03299 18.7363 6.0509 18.9344 6.02908C19.1326 6.00726 19.3245 5.94615 19.4987 5.84933C19.673 5.7525 19.8263 5.6219 19.9495 5.46516C20.0727 5.30842 20.1635 5.12869 20.2164 4.93648C20.2694 4.74426 20.2835 4.54341 20.2579 4.34568C20.2323 4.14796 20.1676 3.95731 20.0675 3.78489C19.8702 3.44511 19.5474 3.19631 19.1687 3.09196ZM19.4793 18.1884C19.1314 17.9951 18.7209 17.948 18.3382 18.0573C17.9555 18.1667 17.632 18.4236 17.4387 18.7715C17.343 18.9438 17.2821 19.1332 17.2596 19.329C17.2372 19.5248 17.2534 19.7231 17.3076 19.9126C17.3617 20.1021 17.4527 20.2791 17.5752 20.4334C17.6978 20.5878 17.8495 20.7165 18.0218 20.8122C18.194 20.9079 18.3835 20.9687 18.5793 20.9912C18.7751 21.0137 18.9734 20.9974 19.1629 20.9432C19.3524 20.8891 19.5293 20.7982 19.6837 20.6756C19.838 20.5531 19.9667 20.4013 20.0624 20.2291C20.2557 19.8811 20.3029 19.4707 20.1935 19.088C20.0842 18.7053 19.8273 18.3817 19.4793 18.1884Z"
          fill="#0192A4"
        />
      </svg>
      {canNativeShare ? "Share" : "copy link"}
    </button>
  );
}
